var __awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function l(t){try{a(i.next(t))}catch(t){r(t)}}function s(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(l,s)}a((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(l=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[0,l.value]),o[0]){case 0:case 1:l=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(l=a.trys,!(l=l.length>0&&l[l.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){a.label=o[1];break}if(6===o[0]&&a.label<l[1]){a.label=l[1],l=o;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(o);break}l[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,r,l,s,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),BrickyEditor;!function(t){var e=function(){function e(t,e,o,i,n,r,l,s){void 0===s&&(s=!1),this.$element=t,this.onAddBlock=e,this.onDeleteBlock=o,this.onSelectBlock=i,this.onDeselectBlock=n,this.onMoveBlock=r,this.onUpdateBlock=l,this.usePlaceholder=s,this.blocks=[],this.isContainer=!0,this.togglePlaceholderIfNeed()}return e.prototype.getData=function(t){var e=[];return this.blocks.forEach(function(o){e.push(o.getData(t))}),e},e.prototype.getHtml=function(){var t=[];this.blocks.forEach(function(e){t.push(e.getHtml(!0))});var e=t.join("\n"),o=this.$element.clone(!1,!1).html(e).wrap("<div></div>");return $("<div></div>").append(o).html()},e.prototype.addBlock=function(e,o,i,n){var r=this;void 0===n&&(n=!0);var l=new t.Block(e,!1,o,function(t){return r.deleteBlock(t)},function(t){return r.selectBlock(t)},function(t){return r.deselectBlock(t)},function(t){return r.copyBlock(t)},function(t,e){return r.moveBlock(t,e)},this.onUpdateBlock);this.insertBlock(l,i),n&&(l.select(),l.scrollTo())},e.prototype.insertBlock=function(t,e){e=e||this.blocks.length,this.selectedBlock&&(e=this.blocks.indexOf(this.selectedBlock)+1),this.blocks.splice(e,0,t),0==e?this.$element.append(t.ui.$editor):this.blocks[e-1].ui.$editor.after(t.ui.$editor),this.onAddBlock(t,e),t.select(null),this.togglePlaceholderIfNeed()},e.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t=null,e<this.blocks.length?this.blocks[e].select():this.blocks.length>0?this.blocks[e-1].select():this.selectedBlock=null,this.onDeleteBlock(t,e),this.togglePlaceholderIfNeed()},e.prototype.moveBlock=function(t,e){var o=this.blocks.indexOf(t),i=o+e;if(!(i>=this.blocks.length||i<0)){var n=this.blocks[i].ui.$editor;e>0?n.after(t.ui.$editor):e<0&&n.before(t.ui.$editor),this.blocks.splice(o,1),this.blocks.splice(i,0,t),this.onMoveBlock(t,o,i),t.scrollTo()}},e.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t)+1;this.addBlock(t.template,t.getData().fields,e,!0)},e.prototype.selectBlock=function(t){this.selectedBlock!==t&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t,this.onSelectBlock(t))},e.prototype.deselectBlock=function(t){this.selectedBlock=null,this.onDeselectBlock(t)},e.prototype.togglePlaceholderIfNeed=function(){this.usePlaceholder&&(0===this.blocks.length?this.$placeholder||(this.$placeholder=$('<i data-bre-placeholder="true">Click here to select this container...</i>'),this.$element.append(this.$placeholder)):this.$placeholder&&(this.$placeholder.remove(),this.$placeholder=null))},e}();t.BlocksContainer=e}(BrickyEditor||(BrickyEditor={})),String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,o=Object(this),i=o.length>>>0,n=arguments[1],r=0;r<i;r++)if(e=o[r],t.call(n,e,r,o))return e});var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){var t="",e=document;return window.getSelection?t=window.getSelection().toString():e.selection&&"Control"!=e.selection.type&&(t=e.selection.createRange().text),t},t.propsEach=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];e(o,i)}},t.propsFilterKeys=function(e,o,i){var n=[];return t.propsEach(e,function(t,e){o(t,e)&&n.push(t)}),i&&n.push(i),n},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(o,i){t.Fields.BaseField.registerCommonFields(),this.$editor=o,this.$editor.addClass(t.Selectors.classEditor),this.options=new t.EditorOptions(i),this.container=this.createContainer(),e.UI=new t.UI(this)}return e.prototype.createContainer=function(){var e=this,o=function(o,i){e.isLoaded&&(e.trigger(t.Events.onBlockAdd,{block:o,idx:i}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()}))},i=function(o,i){e.trigger(t.Events.onBlockDelete,{block:o,idx:i}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n=function(o,i,n,r){e.trigger(t.Events.onBlockUpdate,{block:o,property:i,oldValue:n,newValue:r}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})};return new t.BlocksContainer(this.$editor,o,i,function(o){e.trigger(t.Events.onBlockSelect,{block:o})},function(o){e.trigger(t.Events.onBlockDeselect,{block:o})},function(o,i,n){e.trigger(t.Events.onBlockMove,{block:o,from:i,to:n}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n)},e.prototype.initAsync=function(){return __awaiter(this,void 0,void 0,function(){var o,i;return __generator(this,function(n){switch(n.label){case 0:return e.UI.toggleToolsLoader(!0),[4,t.Services.TemplateService.loadTemplatesAsync(this.options.templatesUrl,this.$editor,this.onError)];case 1:return o=n.sent(),e.UI.toggleToolsLoader(!1),e.UI.setTemplates(o),[4,this.tryLoadInitialBlocksAsync()];case 2:return i=n.sent(),this.loadBlocks(i),this.isLoaded=!0,this.trigger(t.Events.onLoad,this),[2]}})})},e.prototype.tryLoadInitialBlocksAsync=function(){return __awaiter(this,void 0,void 0,function(){var e,o=this;return __generator(this,function(i){return e=this.options.blocksUrl,[2,new Promise(function(i,n){return __awaiter(o,void 0,void 0,function(){var o,r;return __generator(this,function(l){switch(l.label){case 0:if(!e)return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,$.get(e)];case 2:return o=l.sent(),i(o),[3,4];case 3:return r=l.sent(),this.onError(t.EditorStrings.errorBlocksFileNotFound(e)),n(r),[3,4];case 4:return[3,6];case 5:i(this.options.blocks?this.options.blocks:null),l.label=6;case 6:return[2]}})})})]})})},e.prototype.tryBindFormSubmit=function(){var t=this,e=this.options.formSelector?$(this.options.formSelector):null,o=this.options.inputSelector?$(this.options.inputSelector):null;e&&o&&0!=e.length&&0!=o.length&&e.on("submit",function(){return o.val(JSON.stringify(t.getData())),!0})},e.prototype.bindFormSubmit=function(){var t=this,e=this.options.formSelector?$(this.options.formSelector):null,o=this.options.inputSelector?$(this.options.inputSelector):null;e&&o&&0!=e.length&&0!=o.length&&e.on("submit",function(){return o.val(JSON.stringify(t.getData())),!0})},e.prototype.getData=function(){return this.container.getData(this.options.ignoreHtml)},e.prototype.getHtml=function(){return this.container.getHtml()},e.prototype.loadBlocks=function(e){var o=this;e&&e.length&&e.forEach(function(e){var i=t.Services.TemplateService.getTemplate(e.template);if(i)o.container.addBlock(i,e.fields,null,!1);else{var n=t.EditorStrings.errorBlockTemplateNotFound(e.template);o.onError(n)}})},e.prototype.addBlock=function(t){this.getContainer(this.container).addBlock(t,null,null,!0)},e.prototype.getContainer=function(t){if(t.selectedBlock&&t.selectedBlock.isContainer()){var e=t.selectedBlock.selectedField;if(e)return this.getContainer(e.container)}return t},e.prototype.onError=function(t,e){void 0===e&&(e=0),this.options.onError({message:t,code:e})},e.prototype.trigger=function(e,o){var i=this;this.$editor.trigger("bre."+e,o),t.Common.propsEach(i.options,function(t,i){t.breEqualsInvariant(e)&&i&&i(o)})},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t){this.templatesUrl="templates/bootstrap4.html",this.onError=function(t){console.log(t.message)},this.compactTools=null,this.compactToolsWidth=768,this.ignoreHtml=null,this.htmlToolsButtons=null,this.templatesUrl=t.templatesUrl||this.templatesUrl,this.onLoad=t.onLoad||t.onload,this.onChange=t.onChange,this.onBlockAdd=t.onBlockAdd,this.onBlockDelete=t.onBlockDelete,this.onBlockMove=t.onBlockMove,this.onBlockSelect=t.onBlockSelect,this.onBlockDeselect=t.onBlockDeselect,this.onBlockUpdate=t.onBlockUpdate,this.onError=t.onError||this.onError,this.blocksUrl=t.blocksUrl||null,this.blocks=t.blocks||null,this.compactTools=t.compactTools,this.ignoreHtml=t.ignoreHtml||!1,this.htmlToolsButtons=t.htmlToolsButtons||null,this.formSelector=t.formSelector||null,this.inputSelector=t.inputSelector||null}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.errorBlocksFileNotFound=function(t){return"Blocks file not found. Requested file: "+t+"."},t.errorTemplatesFileNotFound=function(t){return"Templates file not found. Requested file: "+t+"."},t.errorBlockTemplateNotFound=function(t){return'Template "'+t+'" not found.'},t.embedFieldLinkTitle="Link to embed media",t.embedFieldLinkPlaceholder="Link to instagram, youtube and etc.",t.imageFieldLinkTitle="Image link",t.imageFieldLinkPlaceholder="http://url-to-image.png",t.imageFieldUploadTitle="or Upload a file",t.imageFieldUploadButton="Select file",t.imageFieldAltTitle="Alt",t.imageFieldAltPlaceholder="Image 'alt' attribute value",t.htmlEditorLinkUrlTitle="Url",t.htmlEditorLinkUrlPlaceholder="http://put-your-link.here",t.htmlEditorLinkTitleTitle="Title",t.htmlEditorLinkTitlePlaceholder="Title attribute for link",t.htmlEditorLinkTargetTitle="Target",t.htmlEditorLinkTargetBlank="Blank",t.htmlEditorLinkTargetSelf="Self",t.htmlEditorLinkTargetParent="Parent",t.htmlEditorLinkTargetTop="Top",t.buttonClose="close",t.buttonOk="Ok",t.buttonCancel="Cancel",t.defaultTemplatesGroupName="Other templates",t}();t.EditorStrings=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.onLoad="onLoad",t.onChange="onChange",t.onBlockAdd="onBlockAdd",t.onBlockDelete="onBlockDelete",t.onBlockMove="onBlockMove",t.onBlockSelect="onBlockSelect",t.onBlockDeselect="onBlockDeselect",t.onBlockUpdate="onBlockUpdate",t}();t.Events=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){var o=new BrickyEditor.Editor(t(this),e);return o.initAsync(),o}}(jQuery);var BrickyEditor;!function(t){var e=function(){function e(e,o,i,n,r,l,s,a,c){var d=this;this.template=e,this.onDelete=n,this.onSelect=r,this.onDeselect=l,this.onCopy=s,this.onMove=a,this.onUpdate=c,this.fields=[],this.template=e;var u=this,h=e.$html.clone();u.bindFields(h,i);var p=this.getActions();this.ui=new t.BlockUI(h,o,p,function(){return d.select()})}return e.prototype.isContainer=function(){return!!this.selectedField&&this.selectedField instanceof t.Fields.ContainerField},e.prototype.bindFields=function(e,o){var i=this,n=this;e.find(t.Selectors.selectorField).addBack(t.Selectors.selectorField).each(function(e,r){var l=function(t,e,o){i.onUpdate&&i.onUpdate(n,t,e,o)},s=function(t){n.select(t)},a=$(r),c=t.Fields.BaseField.createField(a,o,s,l);i.fields.push(c)})},e.prototype.getActions=function(){var e=this;return[new t.BlockUIAction("ellipsis-h"),new t.BlockUIAction("trash-o",function(){return e.delete()}),new t.BlockUIAction("copy",function(){return e.clone()}),new t.BlockUIAction("angle-up",function(){return e.move(-1)}),new t.BlockUIAction("angle-down",function(){return e.move(1)})]},e.prototype.delete=function(){this.ui.delete(),this.onDelete(this)},e.prototype.move=function(t){this.onMove(this,t)},e.prototype.clone=function(){this.onCopy(this)},e.prototype.select=function(t){t!==this.selectedField&&(null===t&&(t=this.fields[0]),this.selectedField&&this.selectedField.deselect(),this.selectedField=t,this.ui.toggleSelection(!0),this.onSelect(this))},e.prototype.deselect=function(){this.selectedField=null,this.fields.forEach(function(t){t.deselect()}),this.ui.toggleSelection(!1),this.onDeselect(this)},e.prototype.scrollTo=function(){var t=this.ui.$editor.offset().top-100;t=t>0?t:0,$("html, body").animate({scrollTop:t},"fast")},e.prototype.getData=function(t){var e=[];this.fields.forEach(function(t){e.push(t.data)});var o={template:this.template.name,fields:e};return t||(o.html=this.getHtml(!0)),o},e.prototype.getHtml=function(e){var o=this.template.$html.clone(!1,!1).wrap("<div></div>").parent(),i={};return this.fields.forEach(function(t){var e=t.name||t.data.name;i[e]=t.getEl()}),o.find(t.Selectors.selectorField).addBack(t.Selectors.selectorField).each(function(t,e){var o=$(e).data().breField;"string"==typeof o&&(o=JSON.parse(o.replace(/'/g,'"')));var n=o.name,r=i[n];$(e).replaceWith(r)}),e?o.html().breTotalTrim():o.html()},e}();t.Block=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,o){this.icon=t,this.action=e,this.title=o}return t}();t.BlockAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o,i){this.$block=t,this.onSelect=i,e||this.buildEditorUI(o)}return e.prototype.delete=function(){this.$editor.remove()},e.prototype.toggleSelection=function(t){this.$editor.toggleClass("bre-selected",t)},e.prototype.buildEditorUI=function(e){var o=this;this.$tools=$('<div class="bre-block-tools bre-btn-deck"></div>'),e.forEach(function(t){var e=o.buildButton(t);o.$tools.append(e)}),t.UI.initBtnDeck(this.$tools),this.$editor=$('<div class="bre-block-wrapper"></div>'),this.$editor.append(this.$tools),this.$editor.append(this.$block),this.$editor.hover(function(){o.$editor.addClass("bre-active")},function(){o.$editor.removeClass("bre-active")}),this.$block.on("click",function(){return o.onSelect()})},e.prototype.buildButton=function(t){var e=$('<button type="button" class="bre-btn"><i class="fa fa-'+t.icon+'"></i></button>');return t.action&&e.on("click",function(e){return t.action(),e.stopPropagation(),!1}),e},e}();t.BlockUI=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,o){this.icon=t,this.action=e,this.title=o}return t}();t.BlockUIAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function o(t,e,o,i){this.$field=t,this.data=e,this.onSelect=o,this.onUpdate=i,this.bind()}return Object.defineProperty(o,"type",{get:function(){var t=this.name;return t=t.replace("Field",""),t=t.substring(0,1).toLowerCase()+t.substring(1)},enumerable:!0,configurable:!0}),o.prototype.getSettingsEl=function(){return null},o.registerCommonFields=function(){e.HtmlField.registerField(),e.ImageField.registerField(),e.EmbedField.registerField(),e.ContainerField.registerField()},o.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},o.createField=function(t,e,o,i){var n=t.data().breField;if(!n)throw"There is no any data in field "+t.html();if("string"==typeof n&&(n=JSON.parse(n.replace(/'/g,'"'))),!n.name)throw"There is no name in data of field "+t.html();if(e){for(var r={},l=0;l<e.length;l++){var s=e[l];if(s.name.toLowerCase()===n.name.toLowerCase()){r=s;break}}r&&(n=$.extend(n,r))}var a=n.type;if(null!=a){if(this._fields.hasOwnProperty(a)){var s=this._fields[a];return new s(t,n,o,i)}throw a+" field not found"}throw"Field type not defined in data-bre-field attribute"},o.prototype.bind=function(){},o.prototype.select=function(){this.$field.addClass(t.Selectors.selectorFieldSelected),this.onSelect(this)},o.prototype.deselect=function(){this.$field.removeClass(t.Selectors.selectorFieldSelected)},o.prototype.getEl=function(){var e=this.$field.clone(!1);return e.removeAttr(t.Selectors.attrField),e},o.prototype.updateProperty=function(t,e,o){void 0===o&&(o=!0);var i=this.data[t];i!==e&&(this.data[t]=e,o&&this.onUpdate(t,i,e))},o._fields={},o}();e.BaseField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;this.container=new t.BlocksContainer(i,function(t){o.updateBlocks()},function(t){o.updateBlocks()},function(t){e.select()},function(t){},function(t){o.updateBlocks()},function(t){o.updateBlocks()},!0),i.addClass(t.Selectors.selectorFieldContainer),i.on("click",function(t){return o.select(),t.stopPropagation(),!1})},o.prototype.updateBlocks=function(){this.updateProperty("blocks",this.container.getData(!0),!0),this.updateProperty("html",this.container.getHtml(),!0)},o.prototype.deselect=function(){this.container.blocks.forEach(function(t){return t.deselect()}),this.$field.removeClass(t.Selectors.selectorFieldSelected)},o.prototype.getEl=function(){var t=this.container.getHtml();return $(t)},o}(e.BaseField);e.ContainerField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.getSettingsEl=function(){var t=$('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return this.$field.before(t),t},Object.defineProperty(o.prototype,"settings",{get:function(){var t=this;return function(e){t.showEmbedLoaderAsync(e)}},enumerable:!0,configurable:!0}),o.prototype.bind=function(){var t=this,e=this;this.$field.on("click",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return this.showEmbedLoaderAsync(e),[2]})})}),e.loadMedia(!1)},o.prototype.showEmbedLoaderAsync=function(e){return __awaiter(this,void 0,void 0,function(){var o,i;return __generator(this,function(n){switch(n.label){case 0:return[4,t.Editor.UI.modal.promptAsync(e.getPromptParams())];case 1:return null==(o=n.sent())?[3,3]:(i=o.getValue("url"))?(e.setUrl(i),[4,e.loadMedia(!0)]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},o.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("url",t.EditorStrings.embedFieldLinkTitle,this.data.url||"http://instagr.am/p/BO9VX2Vj4fF/",t.EditorStrings.embedFieldLinkPlaceholder)]},o.prototype.loadMedia=function(e){return __awaiter(this,void 0,void 0,function(){var o,i,n,r,l;return __generator(this,function(s){switch(s.label){case 0:return o=this,o.data&&o.data.url?[4,t.Services.EmbedService.getEmbedAsync(o.data.url)]:[2];case 1:return i=s.sent(),o.setEmbed(i,e),n=$(i.html),r=n.filter("script"),r.length>0&&(r.remove(),l=r.attr("src"),l.breStartsWith("//")&&(l="https:"+l,$.getScript(l).done(function(e){t.Services.EmbedService.processEmbed(i.provider_name)}).fail(function(t){}))),o.$field.empty(),o.$field.removeAttr("class"),o.$field.removeAttr("style"),o.$field.append(n),o.select(),[2]}})})},o.prototype.setEmbed=function(t,e){void 0===e&&(e=!0),this.updateProperty("embed",t,e)},o.prototype.setUrl=function(t){this.updateProperty("url",t)},o}(e.BaseField);e.EmbedField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;i.is(t.Selectors.selectorContentEditable)||i.attr(t.Selectors.attrContentEditable,"true");var n=this.data.html||this.$field.html();this.setHtml(n,!1),i.html(this.data.html),t.SelectionUtils.bindTextSelection(i,function(e){t.Editor.UI.htmlTools.show(e)}),i.on("blur keyup paste input",function(){e.setHtml(i.html())}).on("paste",function(t){t.preventDefault();var e=t.originalEvent,o=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,o)}).on("click",function(t){return o.select(),t.stopPropagation(),!1})},o.prototype.setHtml=function(t,e){void 0===e&&(e=!0),t=t.trim(),this.$field.html()!==t&&this.$field.html(t),this.updateProperty("html",t,e)},o.prototype.getEl=function(){var o=e.prototype.getEl.call(this);return o.removeAttr(t.Selectors.attrContentEditable),o},o}(e.BaseField);e.HtmlField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;this.data;this.setSrc(this.data.src,!1),i.on("click",function(){return __awaiter(e,void 0,void 0,function(){var e,i,n,r;return __generator(this,function(l){switch(l.label){case 0:return[4,t.Editor.UI.modal.promptAsync(o.getPromptParams())];case 1:return e=l.sent(),null!=e&&(i=e.getValue("file"),n=e.getValue("src"),i?(o.setFile(i),o.setSrc(null)):n&&(o.setSrc(n),o.setFile(null)),r=e.getValue("alt"),o.setAlt(r)),o.select(),[2]}})})})},o.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("src",t.EditorStrings.imageFieldLinkTitle,this.data.url,t.EditorStrings.imageFieldLinkPlaceholder),new t.Prompt.PromptParameterImage("file",t.EditorStrings.imageFieldUploadTitle,this.data.file,t.EditorStrings.imageFieldUploadButton),new t.Prompt.PromptParameter("alt",t.EditorStrings.imageFieldAltTitle,this.data.alt,t.EditorStrings.imageFieldAltPlaceholder)]},o.prototype.setSrc=function(t,e){void 0===e&&(e=!0),t&&(this.isImg?this.$field.attr("src",t):this.$field.css("background-image","url("+t)),this.updateProperty("src",t,e)},o.prototype.setAlt=function(t){this.$field.attr(this.isImg?"alt":"title",t),this.updateProperty("alt",t)},o.prototype.setFile=function(t){t&&(this.isImg?this.$field.attr("src",t.fileContent):this.$field.css("background-image","url("+t.fileContent+")")),this.updateProperty("file",t)},Object.defineProperty(o.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.prop("tagName").toLowerCase()},enumerable:!0,configurable:!0}),o}(e.BaseField);e.ImageField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o,i){this.key=t,this.title=e,this.placeholder=i||"",this.value=o}return t.prototype.parseValue=function(){this.value=this.$input.val(),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=$('<div class="bre-prompt-field">\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.getEditor(),this._$control.append(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){this.value;return $('<input type="text" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+'" value="'+(this.value?this.value:"")+'">')},t}();t.PromptParameter=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function o(t,o,i,n){var r=e.call(this,t,o,i,n)||this;return i&&(r._value=i),r}return __extends(o,e),o.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},o.prototype.getEditor=function(){var e=this,o=this.value&&this.value.fileContent?this.value.fileContent:"",i=$("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        '+this.placeholder+'\n                    </label>                        \n                    <img src="'+o+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),n=$("input",i),r=$("img",i),l=$(".bre-image-input-filename",i),s=this.value;return s&&(r.attr("src",s.fileContent),r.addClass("bre-loaded"),l.text(s.fileInfo.name)),n.change(function(){var o=this;if(o.files&&o.files[0]){var i=new FileReader;i.onload=function(i){var n=i.target;e._value=new t.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new t.PromptParameterImageResultFile(o.files[0]),r.attr("src",e._value.fileContent),r.addClass("bre-loaded"),l.text(e._value.fileInfo.name)},i.readAsDataURL(o.files[0])}}),i},o}(t.PromptParameter);t.PromptParameterImage=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var o=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t){this.params=t}return t.prototype.getValue=function(t){var e=this.params.find(function(e){return e.key===t});return e?e.value:null},t}();t.PromptParameterList=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o){void 0===o&&(o=!1),this.title=t,this.value=e,this.selected=o}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function o(o,i,n,r,l){var s=e.call(this,o,i,r,l)||this;return s.options=[],n.forEach(function(e){s.options.push(new t.PromptParameterOption(e[0],e[1],e[1]==r))}),s}return __extends(o,e),o.prototype.getEditor=function(){var t=this.options.map(function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return $('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+t+"</select>")},o}(t.PromptParameter);t.PromptParameterOptions=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t.getEmbedAsync=function(t){var e=this,o="https://noembed.com/embed?url="+t;return new Promise(function(t,i){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(l){switch(l.label){case 0:e={url:o,type:"get",dataType:"jsonp"},l.label=1;case 1:return l.trys.push([1,3,,4]),[4,$.ajax(e)];case 2:return n=l.sent(),t(n),[3,4];case 3:return r=l.sent(),i(r),[3,4];case 4:return[2]}})})})},t.processEmbed=function(e){switch(e){case t.Instagram:instgrm&&instgrm.Embeds.process()}},t.Instagram="Instagram",t}();t.EmbedService=e}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function e(){}return e.loadTemplatesAsync=function(e,o,i){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(l){return this.templates=[],n=this.templates,[2,new Promise(function(n,l){return __awaiter(r,void 0,void 0,function(){var r,s,a,c,d,u,h,p,f=this;return __generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),[4,$.get(e)];case 1:return r=m.sent(),s=$(r).filter("style"),s&&s.length>0&&o.prepend(s),a=$("<div>"+r+"</div>"),c=$(t.Selectors.selectorTemplateGroup,a),c.each(function(e,o){var i=$(o),n=f.getTemplates(i);f.templates.push(new t.TemplateGroup(i.attr("title"),n)),i.remove()}),d=this.getTemplates(a),u=this.templates.length>0?t.EditorStrings.defaultTemplatesGroupName:"",h=new t.TemplateGroup(u,d),this.templates.push(h),n(this.templates),[3,3];case 2:return p=m.sent(),i(t.EditorStrings.errorTemplatesFileNotFound(e)),l(p),[3,3];case 3:return[2]}})})})]})})},e.getTemplates=function(e){var o=[];return $(t.Selectors.selectorTemplate,e).each(function(e,i){var n=new t.Template(i);o.push(n)}),o},e.getTemplate=function(t){for(var e=0;e<this.templates.length;e++)for(var o=this.templates[e],i=0;i<o.templates.length;i++){var n=o.templates[i];if(n.name.breEqualsInvariant(t))return n}return null},e}();e.TemplateService=o}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){var o=t.Selectors.selectorTemplatePreview,i=$(e),n=i.data();if(this.name=n.name,this.category=n.cactegory||[],this.$html=i.contents().not(o),this.$preview=$(o,i).contents(),!this.$preview.length){var r=new t.Block(this,!0),l=r.getHtml(!0);this.$preview=$(l)}}return e.prototype.getPreview=function(){var e=$("<div class='"+t.Selectors.classTemplate+"'></div>");return e.append(this.$preview),e},e}();t.Template=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e){this.name=t,this.templates=e}return t}();t.TemplateGroup=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t){this.editor=t,this.buttons=[{icon:"bold",command:"Bold",range:!0,aValueArgument:null},{icon:"italic",command:"Italic",range:!0,aValueArgument:null},{icon:"link",command:"CreateLink",range:!0,aValueArgument:null},{icon:"list-ul",command:"insertUnorderedList",range:!0,aValueArgument:null},{icon:"list-ol",command:"insertOrderedList",range:!0,aValueArgument:null},{icon:"undo",command:"Undo",range:!1,aValueArgument:null},{icon:"repeat",command:"Redo",range:!1,aValueArgument:null}],t.options.htmlToolsButtons&&(this.buttons=t.options.htmlToolsButtons),this.setControl()}return e.prototype.setControl=function(){var t=this,e=$('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(o){var i=t.getButtonElement(o.icon,o.command,o.range,o.aValueArgument);e.append(i)}),this.$control=$('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.append(e).hide(),this.editor.$editor.append(this.$control)},e.prototype.getButtonElement=function(e,o,i,n){var r=this;void 0===i&&(i=!0),void 0===n&&(n=null);var l=$('<button type="button" class="bre-btn"><i class="fa fa-'+e+'"></i></button>');return l.on("click",function(){return __awaiter(r,void 0,void 0,function(){var e,r,l,s,a,c,d,u;return __generator(this,function(h){switch(h.label){case 0:return e=window.getSelection(),(r=e.rangeCount>0?e.getRangeAt(0):null,i&&!r)?[2]:"CreateLink"!=o?[3,2]:(l=this.getLinkPromptParams(e),[4,t.Editor.UI.modal.promptAsync(l)]);case 1:return s=h.sent(),a=s.getValue("href"),a&&(document.execCommand(o,!1,a),c=s.getValue("target"),c&&e.anchorNode.parentElement.setAttribute("target",c),
(d=s.getValue("title"))&&e.anchorNode.parentElement.setAttribute("title",d)),[3,3];case 2:"string"==typeof n&&(u=n.replace("%%SELECTION%%",e.toString()));try{document.execCommand(o,!1,u)}catch(t){this.wrapSelectionToContainer(e),document.execCommand(o,!1,u)}h.label=3;case 3:return[2,!1]}})})}),l},e.prototype.wrapSelectionToContainer=function(t){var e=$('<div class="bre-temp-container" contenteditable="true"></div>'),o=$(t.anchorNode.parentElement);e.html(o.html()),o.empty().append(e).removeAttr("contenteditable");var i=document.createRange();i.selectNodeContents(e[0]),t.removeAllRanges(),t.addRange(i)},e.prototype.show=function(t){if(t&&t.width>1){var e=this.editor.$editor.offset(),o=this.editor.$editor.width(),i=t.top-e.top+$(window).scrollTop()+t.height,n=this.$control.width(),r=t.left-e.left+t.width/2-n/2;r<0?r=0:r+n>o&&(r=o-n),this.$control.css({top:i+"px",left:r+"px"}),this.$control.show()}else this.$control.hide()},e.prototype.getLinkPromptParams=function(e){var o="",i="",n="";if(e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var r=$(e.anchorNode.parentNode);o=r.attr("href"),i=r.attr("title"),n=r.attr("target")}return[new t.Prompt.PromptParameter("href",t.EditorStrings.htmlEditorLinkUrlTitle,o,t.EditorStrings.htmlEditorLinkUrlPlaceholder),new t.Prompt.PromptParameter("title",t.EditorStrings.htmlEditorLinkTitleTitle,i,t.EditorStrings.htmlEditorLinkTitlePlaceholder),new t.Prompt.PromptParameterOptions("target",t.EditorStrings.htmlEditorLinkTargetTitle,[["",""],[t.EditorStrings.htmlEditorLinkTargetBlank,"_blank"],[t.EditorStrings.htmlEditorLinkTargetSelf,"_self"],[t.EditorStrings.htmlEditorLinkTargetParent,"_parent"],[t.EditorStrings.htmlEditorLinkTargetTop,"_top"]],n)]},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o,i,n,r){this.$control=t,this.$closeBtn=e,this.$form=o,this.$btns=i,this.$okBtn=n,this.$cancelBtn=r;var l=this;e.on("click",function(){l.hideModal()})}return e.prototype.hideModal=function(){this.restoreSelection(),this.$control.fadeOut()},e.prototype.showModal=function(t,e){void 0===e&&(e=!0),this.saveSelection(),this.$btns.toggle(e),t&&(this.$form.append(t),t.is(":visible")||t.show()),this.$control.fadeIn()},e.prototype.promptAsync=function(e){var o=this,i=this;return new Promise(function(n,r){i.$form.children().not(o.$btns).remove(),e.forEach(function(t){o.$btns.before(t.$control)}),i.$okBtn.on("click",function(){e.forEach(function(t){return t.parseValue()}),i.hideModal();var o=new t.Prompt.PromptParameterList(e);n(o)}),i.$cancelBtn.on("click",function(){i.hideModal(),n(null)}),i.showModal()})},e.prototype.saveSelection=function(){var t=window.getSelection();this.selectionRanges=[];for(var e=0;e<t.rangeCount;e++)this.selectionRanges.push(t.getRangeAt(e))},e.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var t=window.getSelection();t.removeAllRanges(),this.selectionRanges.forEach(function(e){return t.addRange(e)})}},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,o;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(o=e.getRangeAt(0),o.deleteContents(),o.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.bindTextSelection=function(t,e){var o=this;t.is("[contenteditable]")&&(t.on("mouseup",function(){setTimeout(function(){var t=o.getSelectionRect();e(t)},0)}),t.on("keyup",function(t){var i=o.getSelectionRect();e(i)}))},t.getSelectionRect=function(){var t=window.getSelection(),e=t.getRangeAt(0);if(e){var o=e.getBoundingClientRect();if(o)return o}return null},t}();t.SelectionUtils=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.attr=function(t){return"["+t+"]"},t.attrContentEditable="contenteditable",t.selectorContentEditable="contenteditable",t.attrField="data-bre-field",t.selectorField="["+t.attrField+"]",t.classEditor="bre-editor",t.classTemplate="bre-template",t.selectorTemplate="."+t.classTemplate,t.classTemplateGroup="bre-template-group",t.selectorTemplateGroup="."+t.classTemplateGroup,t.selectorTemplatePreview=".bre-template-preview",t.classMobile="brickyeditor-tools-mobile",t.htmlToolsCommand="data-bre-doc-command",t.htmlToolsCommandRange="data-bre-doc-command-range",t.selectorFieldSelected="bre-field-selected",t.selectorFieldContainer="bre-field-container",t.selectorHtmlToolsCommand=t.attr(t.htmlToolsCommand),t.selectorHtmlToolsCommandRange=t.attr(t.htmlToolsCommandRange),t}();t.Selectors=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){this.editor=e,this.editor=e,this.setTools(),this.setModal(),this.htmlTools=new t.HtmlTools(this.editor)}return Object.defineProperty(e.prototype,"isCompactTools",{get:function(){var t=this.editor.options.compactTools;return null==t?window.innerWidth<this.editor.options.compactToolsWidth:t.valueOf()},enumerable:!0,configurable:!0}),e.prototype.setTools=function(){var t=this;this.$tools=$('<div class="bre bre-tools" data-bricky-tools></div>'),this.$toolsTemplates=$('<div class="bre-tools-templates"></div>'),this.$toolsLoader=$('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=$('<button type="button" class="bre-tools-toggle"><div>►</div></button>'),this.$tools.append([this.$toolsHideBtn,this.$toolsLoader,this.$toolsTemplates]),this.$toolsHideBtn.on("click",function(){return t.toggleTools()}),this.editor.$editor.append(this.$tools),this.isCompactTools&&(this.$tools.addClass("bre-tools-templates-compact"),this.toggleTools())},e.prototype.toggleTools=function(){this.$tools.toggleClass("bre-tools-collapsed",!this.$toolsHideBtn.hasClass("bre-tools-toggle-collapsed")),this.$toolsHideBtn.toggleClass("bre-tools-toggle-collapsed")},e.prototype.setModal=function(){var e=$('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),o=$('<div class="bre-modal-close"><a href="#">'+t.EditorStrings.buttonClose+" ✖</a></div>"),i=$('<div class="bre-modal-content"></div>'),n=$("<form></form>"),r=$('<div class="bre-btns"></div>'),l=$('<button type="button" class="bre-btn bre-btn-primary">'+t.EditorStrings.buttonOk+"</button>"),s=$('<button type="button" class="bre-btn">'+t.EditorStrings.buttonCancel+"</button>");r.append(l),r.append(s),n.append(r),i.append(n);var a=$(".bre-modal-placeholder",e);a.append(o),a.append(i),this.modal=new t.Modal(e,o,n,r,l,s),this.editor.$editor.append(e)},e.prototype.toggleToolsLoader=function(t){this.$toolsLoader.toggle(t)},e.prototype.setTemplates=function(e){var o=this,i=this.editor;e.forEach(function(e){if(0!==e.templates.length){var n=$("<div class='"+t.Selectors.classTemplateGroup+"'>"+e.name+"</div>");o.$toolsTemplates.append(n);var r=$("<div></div>");e.templates.forEach(function(t){var e=t.getPreview();e.attr("title",t.name),e.on("click",function(e){return i.addBlock(t),e.stopPropagation(),!1}),r.append(e)}),n.on("click",function(){r.toggle()}),o.$toolsTemplates.append(r)}})},e.initBtnDeck=function(t){$(".bre-btn",t).eq(0).on("click",function(o){return e.toggleBtnDeck(t),o.stopPropagation(),!1})},e.toggleBtnDeck=function(t,e){var o=$(".bre-btn",t);if(o&&0!=o.length){var i=o.eq(0);e=e||t.data().isOn||!1,e?(t.css({height:0,width:0}),o.not(":first").css({opacity:0,top:0,left:0})):(o.not(":first").each(function(t,e){$(e).css({opacity:1,left:(t+1)*(32+32/6)})}),t.css({height:32,width:(32+32/6)*o.length-32/6})),i.toggleClass("bre-btn-active",!e),t.data("isOn",!e)}},e}();t.UI=e}(BrickyEditor||(BrickyEditor={}));